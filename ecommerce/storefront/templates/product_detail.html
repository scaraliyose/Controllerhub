<!-- storefront/templates/product_detail.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>{{ product.name }} – Details</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; }
    .muted { color: #666; font-size: 0.9rem; }
    .stars { letter-spacing: 2px; }
  </style>
</head>
<body>
  <a href="{% url 'home' %}">← Back</a>

  <h1>{{ product.name }}</h1>
  <p><strong>${{ product.price }}</strong></p>
  {% if product.image %}
    <img src="{{ product.image.url }}" alt="{{ product.name }}" style="max-width:300px; display:block; margin: 1rem 0;">
  {% endif %}

  <p class="muted">
    Average rating: {{ product.average_rating|floatformat:1 }} ({{ product.reviews_count }} reviews)
  </p>

  <h2>Reviews</h2>
  {% if reviews %}
    {% for r in reviews %}
      <div class="card">
        <div class="stars">Rating: {{ r.rating }} / 5 ⭐</div>
        <strong>{{ r.title }}</strong><br/>
        <span class="muted">
          by
          {% if r.customer %}
            {{ r.customer.first_name }} {{ r.customer.last_name }}
          {% else %}
            {{ r.author_name|default:"Anonymous" }}
          {% endif %}
          on {{ r.created_at|date:"M j, Y" }}
        </span>
        <p>{{ r.body }}</p>
      </div>
    {% endfor %}
  {% else %}
    <p class="muted">No reviews yet. Be the first!</p>
  {% endif %}

  <h2>Write a review</h2>
  {% if messages %}
    {% for m in messages %}
      <div class="card">{{ m }}</div>
    {% endfor %}
  {% endif %}
  <form method="post" class="card">
    {% csrf_token %}
    <div>
      <label>Rating (1–5)</label><br/>
      {{ form.rating }}
    </div>
    <div>
      <label>Title</label><br/>
      {{ form.title }}
    </div>
    <div>
      <label>Review</label><br/>
      {{ form.body }}
    </div>
    <hr/>
    <p class="muted">If you’re not logged in, please leave your name and email.</p>
    <div>
      <label>Name</label><br/>
      {{ form.author_name }}
    </div>
    <div>
      <label>Email</label><br/>
      {{ form.author_email }}
    </div>
    <br/>
    <button type="submit">Submit review</button>
  </form>
</body>
</html>
